<div class="mainForm">
  <form [formGroup]="questionarioFormGroup">
    @if(competences.legth > 0){ 
      <mat-stepper #linearVerticalStepper="matVerticalStepper" [linear]="isLinear" formArrayName="competences" #stepper>

        @for (competence of iterableCompetences; track competence; let i = $index) {
        <mat-step #mat_step [formGroupName]="i" [stepControl]="competences?.get([i])">
          <ng-template matStepLabel>>{{'Q'}}{{ i+1 }}</ng-template>
          <h3>{{competence.descricao}}</h3>
          <ng-container formArrayName="habilidades">
            <div [ngStyle]="{ 'display':'flex', 'flex-direction': 'column'}"
              *ngFor="let habilidade of competence.habilidades; let j = index">
              <span>{{makeSkill(habilidade).question}}</span>
              <mat-form-field [ngClass]="'mat-form-selector'">
                <mat-label>Escolha</mat-label>
                <mat-select [formControlName]="j" required>
                  @for (skill of skillLevelsOptions; track $index) {
                  <mat-option [value]="getSkillLevelsAswerNumberValue(skill)" (onSelectionChange)="test()">
                    {{getSkillLevelsAswer[skill]}}
                  </mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
          </ng-container>
        </mat-step>
        }
        <!-- <mat-step #mat_step *ngFor="let competence of iterableCompetences; let i = index" [formGroupName]="i" [stepControl]="competences?.get([i])">
          <ng-template matStepLabel>>{{'Q'}}{{ i+1 }}</ng-template>
          <h3>{{competence.descricao}}</h3>
          <ng-container formArrayName="habilidades">
            <div [ngStyle]="{ 'display':'flex', 'flex-direction': 'column'}" *ngFor="let habilidade of competence.habilidades; let j = index">
              <span>{{makeSkill(habilidade).question}}</span>
              <mat-form-field [ngClass]="'mat-form-selector'">
                <mat-label>Escolha</mat-label>
                <mat-select  [formControlName]="j" required >
                    <mat-option *ngFor="let skill of skillLevelsOptions" [value]="getSkillLevelsAswerNumberValue(skill)" (onSelectionChange)="test()">
                        {{getSkillLevelsAswer[skill]}}
                    </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </ng-container>
        </mat-step> -->
        <mat-step>
          <ng-template matStepLabel>Fim</ng-template>
          Gostaria de enviar o questionário?
          <div>
            <button mat-button matStepperPrevious>Voltar</button>
            <button mat-button (click)="onSubmit(stepper)">Enviar</button>
          </div>
        </mat-step>
      </mat-stepper>
    } @else {
    <h3 class="no-competences">Nenhuma competência encontrada</h3>}

  </form>

</div>